## otus_mdadm_RAID

## –î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ: —Ä–∞–±–æ—Ç–∞ —Å mdadm   
–ó–∞–¥–∞–Ω–∏–µ:   
‚Ä¢ –î–æ–±–∞–≤–∏—Ç—å –≤ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—É—é –º–∞—à–∏–Ω—É –Ω–µ—Å–∫–æ–ª—å–∫–æ –¥–∏—Å–∫–æ–≤   
‚Ä¢ –°–æ–±—Ä–∞—Ç—å RAID-0/1/5/10 –Ω–∞ –≤—ã–±–æ—Ä   
‚Ä¢ –°–ª–æ–º–∞—Ç—å –∏ –ø–æ—á–∏–Ω–∏—Ç—å RAID   
‚Ä¢ –°–æ–∑–¥–∞—Ç—å GPT —Ç–∞–±–ª–∏—Ü—É, –ø—è—Ç—å —Ä–∞–∑–¥–µ–ª–æ–≤ –∏ —Å–º–æ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –∏—Ö –≤ —Å–∏—Å—Ç–µ–º–µ   

–ù–∞ –ø—Ä–æ–≤–µ—Ä–∫—É –æ—Ç–ø—Ä–∞–≤—å—Ç–µ:   
‚Ä¢ C–∫—Ä–∏–ø—Ç –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ä–µ–π–¥–∞   
‚Ä¢ –û—Ç—á–µ—Ç –ø–æ –∫–æ–º–∞–Ω–¥–∞–º –¥–ª—è –ø–æ—á–∏–Ω–∫–∏ RAID –∏ —Å–æ–∑–¥–∞–Ω–∏—é —Ä–∞–∑–¥–µ–ª–æ–≤   



## üß≠ –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ

- [‚úçüèª –°–∫—Ä–∏–ø—Ç –¥–ª—è —Å–±–æ—Ä–∫–∏ RAID 1](#script)
- [‚úçüèª –°–∫—Ä–∏–ø—Ç —Å–∏–º—É–ª—è—Ü–∏–∏ –æ—Ç–∫–∞–∑–∞ –¥–∏—Å–∫–∞](#fixraid)
- [üìÄ –î–∏—Å–∫–∏ –∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞](#hard)
- [üß± –†–∞–∑–º–µ—Ç–∫–∞ –∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∏—Å–∫–∞](#partition)
- [üóÉÔ∏è –°–±–æ—Ä–∫–∞ RAID 1](#setup)
- [üí• –°–∏–º—É–ª—è—Ü–∏—è –æ—Ç–∫–∞–∑–∞ –¥–∏—Å–∫–∞](#failure)
- [üõ†Ô∏è RAID 1 –±–µ–∑ –ø–æ—Ç–µ—Ä–∏ –¥–∞–Ω–Ω—ã—Ö](#preserve)
- [‚úÇÔ∏è –£–º–µ–Ω—å—à–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ —Ä–∞–∑–¥–µ–ª–∞](#resize)

---

<a id="script"></a>
## ‚úçüèª –°–∫—Ä–∏–ø—Ç –¥–ª—è —Å–±–æ—Ä–∫–∏ RAID 1
–ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ sudo bash script.sh

```bash
#!/bin/bash

mkdir -p /mnt/raid01
apt-get install -y mdadm
mdadm --create --verbose /dev/md127 --level=1 --raid-devices=2 /dev/sdb1 /dev/sdb2
mkfs.ext4 /dev/md127
mount /dev/md127 /mnt/raid01
echo "/dev/md127 /mnt/raid01 ext4 defaults 0 0" >> /etc/fstab
mdadm --detail --scan >> /etc/mdadm/mdadm.conf
update-initramfs -u
```

---

<a id="fixraid"></a>
## ‚úçüèª –°–∫—Ä–∏–ø—Ç —Å–∏–º—É–ª—è—Ü–∏–∏ –æ—Ç–∫–∞–∑–∞ –¥–∏—Å–∫–∞
–ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ sudo bash script.sh
–î–∞—Ç—å –ø—Ä–∞–≤–∞ chmod +x script.sh

```bash
#!/bin/bash

mdadm /dev/md127 --fail /dev/sdb1
mdadm /dev/md127 --remove /dev/sdb1
mdadm --zero-superblock /dev/sdb3 >/dev/null 2>&1
mdadm /dev/md127 --add /dev/sdb3
watch -n 1 cat /proc/mdstat
```

---

<a id="hard"></a>
## üìÄ –î–∏—Å–∫–∏ –∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞

```bash
# –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–∏—Å–∫–æ–≤ –∏ —Ä–∞–∑–¥–µ–ª–æ–≤ –≤ –≤–∏–¥–µ –¥–µ—Ä–µ–≤–∞
lsblk
# –í—ã–≤–æ–¥–∏—Ç —Å–ø–∏—Å–æ–∫ —Ñ–∏–∑–∏—á–µ—Å–∫–∏—Ö –¥–∏—Å–∫–æ–≤ –∏ –∏—Ö —Ä–∞–∑–¥–µ–ª–æ–≤ –≤ —Å–∏—Å—Ç–µ–º–µ
ls -la /dev/sd*
```

---

<a id="partition"></a>
## üß± –†–∞–∑–º–µ—Ç–∫–∞ –∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∏—Å–∫–∞

```bash
# –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–µ–∫—É—â—É—é —Ç–∞–±–ª–∏—Ü—É —Ä–∞–∑–¥–µ–ª–æ–≤ –¥–∏—Å–∫–∞ /dev/sdb (—Ä–∞–∑–º–µ—Ä—ã, —Ç–∏–ø—ã, –Ω–∞—á–∞–ª—å–Ω—ã–µ —Å–µ–∫—Ç–æ—Ä–∞)
fdisk -l /dev/sdb
# –ó–∞–ø—É—Å–∫ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–∞–∑–¥–µ–ª–∞–º–∏ –¥–∏—Å–∫–∞
fdisk /dev/sdb
# –î–µ–π—Å—Ç–≤–∏—è –≤–Ω—É—Ç—Ä–∏ fdisk:
# m ‚Äî –º–µ–Ω—é –∫–æ–º–∞–Ω–¥
# p ‚Äî —Ç–µ–∫—É—â–∞—è —Ç–∞–±–ª–∏—Ü–∞ —Ä–∞–∑–¥–µ–ª–æ–≤
# n ‚Äî —Å–æ–∑–¥–∞—Ç—å —Ä–∞–∑–¥–µ–ª (primary/extended)
# w ‚Äî –∑–∞–ø–∏—Å–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏ –≤—ã–π—Ç–∏
# –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç —Ä–∞–∑–¥–µ–ª /dev/sdb1 –≤ —Ñ–∞–π–ª–æ–≤—É—é —Å–∏—Å—Ç–µ–º—É ext4
mkfs.ext4 /dev/sdb1
# –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –¥—Ä–µ–≤–æ–≤–∏–¥–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–∏—Å–∫–æ–≤ –∏ —Ä–∞–∑–¥–µ–ª–æ–≤ (–∏–º–µ–Ω–∞, —Ä–∞–∑–º–µ—Ä—ã, —Ç–æ—á–∫–∏ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)
lsblk
# –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç UUID –∏ —Ç–∏–ø —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã –¥–ª—è –≤—Å–µ—Ö —Ä–∞–∑–¥–µ–ª–æ–≤ (–Ω—É–∂–µ–Ω –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ /etc/fstab)
blkid
# –°–æ–∑–¥–∞–µ—Ç –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ /mnt/disk1, /disk2 –∏ —Ç.–¥. –¥–ª—è –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–∞–∑–¥–µ–ª–æ–≤
# –§–ª–∞–≥ -p –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç –æ—à–∏–±–∫–∏, –µ—Å–ª–∏ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É—é—Ç
mkdir -p /mnt/disk1 /mnt/disk2 /mnt/disk3 /mnt/disk4
# –ú–æ–Ω—Ç–∏—Ä—É–µ—Ç —Ä–∞–∑–¥–µ–ª /dev/sdb1 –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é /mnt/disk1 (–≤—Ä–µ–º–µ–Ω–Ω–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ)
mount /dev/sdb1 /mnt/disk1
# –†–µ–¥–∞–∫—Ç–∏—Ä—É–µ—Ç —Ñ–∞–π–ª fstab –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–∞–∑–¥–µ–ª–æ–≤ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
nano /etc/fstab
# –ü—Ä–∏–º–µ—Ä —Å—Ç—Ä–æ–∫–∏
UUID=1234-ABCD /mnt/disk1 ext4 defaults 0 2
```

---

<a id="setup"></a>
## üóÉÔ∏è –°–±–æ—Ä–∫–∞ RAID 1 —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º mdadm

```bash
# –°–æ–∑–¥–∞–µ—Ç –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é /mnt/raid01 –¥–ª—è –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è RAID-–º–∞—Å—Å–∏–≤–∞
mkdir /mnt/raid01
# –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç–∞—Ç—É—Å RAID-–º–∞—Å—Å–∏–≤–æ–≤ –≤ —Å–∏—Å—Ç–µ–º–µ (–∞–∫—Ç–∏–≤–Ω—ã–µ –º–∞—Å—Å–∏–≤—ã, –ø—Ä–æ—Ü–µ—Å—Å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏, —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞)
cat /proc/mdstat
# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —É—Ç–∏–ª–∏—Ç—É mdadm –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–≥—Ä–∞–º–º–Ω—ã–º–∏ RAID-–º–∞—Å—Å–∏–≤–∞–º–∏ –≤ Linux
apt install mdadm
# –°–æ–∑–¥–∞–µ—Ç RAID 1 (–∑–µ—Ä–∫–∞–ª–æ) –∏–∑ –¥–≤—É—Ö —Ä–∞–∑–¥–µ–ª–æ–≤, –≥–¥–µ /dev/md127 ‚Äî –∏–º—è –º–∞—Å—Å–∏–≤–∞, -l 1 ‚Äî —É—Ä–æ–≤–µ–Ω—å RAID (–∑–µ—Ä–∫–∞–ª–∏—Ä–æ–≤–∞–Ω–∏–µ), -n 2 ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤
mdadm --create /dev/md127 -l 1 -n 2 /dev/sdb1 /dev/sdb2
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ RAID (–Ω–∞–ø—Ä–∏–º–µ—Ä, resync = 50%).
cat /proc/mdstat
# –í—ã–≤–æ–¥–∏—Ç –¥–µ—Ç–∞–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –º–∞—Å—Å–∏–≤–µ:
# –°–æ—Å—Ç–æ—è–Ω–∏–µ (active, degraded)
# –°–ø–∏—Å–æ–∫ —É—Å—Ç—Ä–æ–π—Å—Ç–≤ (/dev/sdb1, /dev/sdb2)
# UUID –º–∞—Å—Å–∏–≤–∞
mdadm -D /dev/md127
# –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç RAID-–º–∞—Å—Å–∏–≤ –≤ —Ñ–∞–π–ª–æ–≤—É—é —Å–∏—Å—Ç–µ–º—É ext4 (–≥–æ—Ç–æ–≤ –∫ —Ö—Ä–∞–Ω–µ–Ω–∏—é –¥–∞–Ω–Ω—ã—Ö)
mkfs.ext4 /dev/md127
# –ú–æ–Ω—Ç–∏—Ä—É–µ—Ç –º–∞—Å—Å–∏–≤ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é /mnt/raid01 –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –¥–∞–Ω–Ω—ã–º
mount /dev/md127 /mnt/raid01
# –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–≤–æ–±–æ–¥–Ω–æ–µ –º–µ—Å—Ç–æ –Ω–∞ –≤—Å–µ—Ö —Å–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤—ã—Ö —Å–∏—Å—Ç–µ–º–∞—Ö, –≤–∫–ª—é—á–∞—è RAID
df -h
# –ö–æ–ø–∏—Ä—É–µ—Ç —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ /var/log/ –≤ RAID-–º–∞—Å—Å–∏–≤ –¥–ª—è —Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–∏—è –ª–æ–≥–æ–≤
cp -r /var/log/* /mnt/raid01
# –†–µ–¥–∞–∫—Ç–∏—Ä—É–µ—Ç —Ñ–∞–π–ª fstab –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–∞–∑–¥–µ–ª–æ–≤ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
nano /etc/fstab
# –ü—Ä–∏–º–µ—Ä —Å—Ç—Ä–æ–∫–∏ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è RAID
/dev/md127 /mnt/raid01 ext4 defaults 0 0
```

---

<a id="failure"></a>
## üí• –°–∏–º—É–ª—è—Ü–∏—è –æ—Ç–∫–∞–∑–∞ –¥–∏—Å–∫–∞ –≤ RAID 1 –∏ –µ–≥–æ –∑–∞–º–µ–Ω–∞

```bash
# –í—ã–≤–æ–¥–∏—Ç –¥–µ—Ç–∞–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –º–∞—Å—Å–∏–≤–µ:
# –°–æ—Å—Ç–æ—è–Ω–∏–µ (active, degraded)
# –°–ø–∏—Å–æ–∫ —É—Å—Ç—Ä–æ–π—Å—Ç–≤ (/dev/sdb1, /dev/sdb2)
# UUID –º–∞—Å—Å–∏–≤–∞
mdadm -D /dev/md127
# –ü–æ–º–µ—á–∞–µ—Ç –¥–∏—Å–∫ /dev/sdb1 –∫–∞–∫ –Ω–µ–∏—Å–ø—Ä–∞–≤–Ω—ã–π (–∏–Ω–∏—Ü–∏–∏—Ä—É–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å –∑–∞–º–µ–Ω—ã)
mdadm /dev/md127 --fail /dev/sdb1
# –£–¥–∞–ª—è–µ—Ç –Ω–µ–∏—Å–ø—Ä–∞–≤–Ω—ã–π –¥–∏—Å–∫ /dev/sdb1 –∏–∑ –º–∞—Å—Å–∏–≤–∞ (–ø–æ—Å–ª–µ --fail)
mdadm /dev/md127 --remove /dev/sdb1
# –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ RAID –Ω–∞ –¥–∏—Å–∫–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –±—ã–ª –ª–∏ –¥–∏—Å–∫ —á–∞—Å—Ç—å—é –º–∞—Å—Å–∏–≤–∞)
mdadm --examine /dev/sdX
# –û—á–∏—â–∞–µ—Ç —Å—É–ø–µ—Ä–±–ª–æ–∫ RAID –Ω–∞ –¥–∏—Å–∫–µ –ø–µ—Ä–µ–¥ –ø–æ–≤—Ç–æ—Ä–Ω—ã–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º (—É–¥–∞–ª—è–µ—Ç —Å–ª–µ–¥—ã —É—á–∞—Å—Ç–∏—è –≤ –º–∞—Å—Å–∏–≤–µ)
mdadm --zero-superblock /dev/sdX
# –î–æ–±–∞–≤–ª—è–µ—Ç –Ω–æ–≤—ã–π –¥–∏—Å–∫ /dev/sdb3 –≤ –º–∞—Å—Å–∏–≤ –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è (–Ω–∞—á–Ω–µ—Ç—Å—è —Ä–µ—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö)
mdadm /dev/md127 --add /dev/sdb3
# –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç —Ç–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å RAID, –≤–∫–ª—é—á–∞—è –ø—Ä–æ–≥—Ä–µ—Å—Å —Ä–µ—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, resync = 75%)
cat /proc/mdstat
```

---

<a id="preserve"></a>
## üõ†Ô∏è –°–æ–∑–¥–∞–Ω–∏–µ RAID 1 –±–µ–∑ –ø–æ—Ç–µ—Ä–∏ –¥–∞–Ω–Ω—ã—Ö

```bash
# –°–æ–∑–¥–∞—Ç—å RAID 1 –∏–∑ –¥–≤—É—Ö –¥–∏—Å–∫–æ–≤, –≥–¥–µ –æ–¥–∏–Ω –¥–∏—Å–∫ —É–∂–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –¥–∞–Ω–Ω—ã–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `/dev/sdb1`)    
# –≠—Ç–∏ –¥–∞–Ω–Ω—ã–µ –Ω—É–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å, –æ–±—ä–µ–¥–∏–Ω–∏–≤ –µ–≥–æ —Å –Ω–æ–≤—ã–º –¥–∏—Å–∫–æ–º (`/dev/sdb2`) –≤ –∑–µ—Ä–∫–∞–ª—å–Ω—ã–π RAID-–º–∞—Å—Å–∏–≤   

# –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –¥–∏—Å–∫–æ–≤ –∏ –∏—Ö —Ä–∞–∑–¥–µ–ª–æ–≤ –ø–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º —Ä–∞–±–æ—Ç—ã.
lsblk
# –°–æ–∑–¥–∞–µ—Ç RAID 1 —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏:
# /dev/md127 ‚Äî –∏–º—è –º–∞—Å—Å–∏–≤–∞
# -l 1 ‚Äî —É—Ä–æ–≤–µ–Ω—å RAID (–∑–µ—Ä–∫–∞–ª–æ)
# -n 2 ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤
# /dev/sdb2 ‚Äî –∞–∫—Ç–∏–≤–Ω—ã–π –¥–∏—Å–∫
# missing ‚Äî –≤—Ç–æ—Ä–æ–π –¥–∏—Å–∫ –¥–æ–±–∞–≤–ª–µ–Ω –ø–æ–∑–∂–µ (—á—Ç–æ–±—ã –Ω–µ —Å—Ç–∏—Ä–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –Ω–∞ /dev/sdb1)
mdadm --create /dev/md127 -l 1 -n 2 /dev/sdb2 missing
# –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –º–∞—Å—Å–∏–≤–∞: —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –º–∞—Å—Å–∏–≤ —Å–æ–∑–¥–∞–Ω, –Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ degraded mode (—Ç–æ–ª—å–∫–æ —Å –æ–¥–Ω–∏–º –¥–∏—Å–∫–æ–º)
mdadm -D /dev/md127
# –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç RAID-–º–∞—Å—Å–∏–≤ –≤ —Ñ–∞–π–ª–æ–≤—É—é —Å–∏—Å—Ç–µ–º—É ext4 (–¥–∞–Ω–Ω—ã–µ –Ω–∞ /dev/sdb1 –Ω–µ –∑–∞—Ç—Ä–∞–≥–∏–≤–∞—é—Ç—Å—è)
mkfs.ext4 /dev/md127
# –°–æ–∑–¥–∞–µ—Ç –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é /mnt/raid02 –¥–ª—è –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è RAID-–º–∞—Å—Å–∏–≤–∞
mkdir /mnt/raid02
# –ü–æ–¥–∫–ª—é—á–∞–µ—Ç –º–∞—Å—Å–∏–≤ –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
mount /dev/md127 /mnt/raid02
# –ö–æ–ø–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ —Å –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –¥–∏—Å–∫–∞ (/mnt/raid01, –≥–¥–µ —Å–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω /dev/sdb1) –≤ –Ω–æ–≤—ã–π RAID-–º–∞—Å—Å–∏–≤
cp -r /mnt/raid01/* /mnt/raid02
# –û—Ç–∫–ª—é—á–∞–µ—Ç –∏—Å—Ö–æ–¥–Ω—ã–π –¥–∏—Å–∫ (/dev/sdb1) –ø–µ—Ä–µ–¥ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º –µ–≥–æ –≤ –º–∞—Å—Å–∏–≤
umount /mnt/raid01
# –î–æ–±–∞–≤–ª—è–µ—Ç –¥–∏—Å–∫ /dev/sdb1 –≤ –º–∞—Å—Å–∏–≤, –∑–∞–ø—É—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é –¥–∞–Ω–Ω—ã—Ö (–∑–µ—Ä–∫–∞–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —Å /dev/sdb2)
mdadm /dev/md127 --add /dev/sdb1
# –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç–∞—Ç—É—Å –º–∞—Å—Å–∏–≤–∞ (–ø—Ä–æ–≥—Ä–µ—Å—Å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏)
mdadm -D /dev/md127
# –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, resync = 75%)
watch cat /proc/mdstat
# –û—Ç–∫–ª—é—á–∞–µ—Ç –≤—Ä–µ–º–µ–Ω–Ω—É—é —Ç–æ—á–∫—É –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
umount /mnt/raid02
# –ü–æ–¥–∫–ª—é—á–∞–µ—Ç RAID-–º–∞—Å—Å–∏–≤ –∫ –∏—Å—Ö–æ–¥–Ω–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ (/mnt/raid01), –∑–∞–º–µ–Ω—è—è —Å—Ç–∞—Ä—ã–π –¥–∏—Å–∫
mount /dev/md127 /mnt/raid01
```

---

<a id="resize"></a>
## ‚úÇÔ∏è –£–º–µ–Ω—å—à–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Ä–∞–∑–¥–µ–ª–∞ (sdb4 ‚Üí 5G)

```bash
# sdb      8:16   0   25G  0 disk   
# ‚îú‚îÄsdb1   8:17   0    5G  0 part   
# ‚îú‚îÄsdb2   8:18   0    5G  0 part   
# ‚îú‚îÄsdb3   8:19   0    5G  0 part   
# ‚îî‚îÄsdb4   8:20   0   10G  0 part   

# –ß—Ç–æ–±—ã —Ä–∞–∑–±–∏—Ç—å —Ä–∞–∑–¥–µ–ª /dev/sdb4 (10‚ÄØGB) –Ω–∞ –¥–≤–∞ —Ä–∞–∑–¥–µ–ª–∞ –ø–æ 5‚ÄØGB, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —É–¥–∞–ª–∏—Ç—å —Ç–µ–∫—É—â–∏–π sdb4 (–µ—Å–ª–∏ –Ω–∞ –Ω—ë–º –Ω–µ—Ç –≤–∞–∂–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö!):
# –ó–∞–ø—É—Å–∫ —É—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü—ã —Ä–∞–∑–¥–µ–ª–æ–≤ –¥–∏—Å–∫–∞ /dev/sdb
sudo fdisk /dev/sdb
# –î–µ–π—Å—Ç–≤–∏—è –≤–Ω—É—Ç—Ä–∏ fdisk:
# d ‚Üí 4 ‚Äî —É–¥–∞–ª–µ–Ω–∏–µ —Ä–∞–∑–¥–µ–ª–∞ /dev/sdb4
# n ‚Üí p ‚Üí 4 ‚Üí +5G ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø–µ—Ä–≤–∏—á–Ω–æ–≥–æ —Ä–∞–∑–¥–µ–ª–∞ (p) /dev/sdb4 —Ä–∞–∑–º–µ—Ä–æ–º 5 GB
# n ‚Üí p ‚Üí 5 ‚Üí Enter ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ —Ä–∞–∑–¥–µ–ª–∞ /dev/sdb5 –Ω–∞ –æ—Å—Ç–∞–≤—à–µ–º—Å—è –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ (5 GB)
# w ‚Äî —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –∏ –≤—ã—Ö–æ–¥
# –í–∞–∂–Ω–æ: –ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ —É —Ç–µ–±—è –±—É–¥–µ—Ç 4 primary —Ä–∞–∑–¥–µ–ª–∞, sdb1‚Äìsdb4. –î–ª—è –ø—è—Ç–æ–≥–æ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å extended partition, –µ—Å–ª–∏ –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç primary-—Å–ª–æ—Ç–æ–≤
# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ä–∞–∑–¥–µ–ª–∞—Ö –≤ —è–¥—Ä–µ —Å–∏—Å—Ç–µ–º—ã –±–µ–∑ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏
sudo partprobe
# –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö —Ä–∞–∑–¥–µ–ª–æ–≤ –≤ —Ñ–∞–π–ª–æ–≤—É—é —Å–∏—Å—Ç–µ–º—É ext4
sudo mkfs.ext4 /dev/sdb4
sudo mkfs.ext4 /dev/sdb5
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π –∏–ª–∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —Ä–∞–∑–¥–µ–ª–æ–≤
fdisk /dev/sdb
```

---
